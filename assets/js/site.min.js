var e;!function(){"use strict";var a;window.addEventListener("load",function(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,function(e){e.addEventListener("submit",function(a){!1===e.checkValidity()&&(a.preventDefault(),a.stopPropagation(),$("#errors").removeClass("d-none"),$("html, body").scrollTop($("#errors").offset().top)),e.classList.add("was-validated")},!1)})},!1),$("input[type=radio][name=race_package]").change(function(){switch($(this).val().toLowerCase()){case"only_registration":$("select","#tshirt").prop("disabled",!0),$("input","#donate_field").prop("disabled",!0),$("#shipping-details").addClass("d-none").prop("disabled",!0),$("#price-shipping").removeClass("d-flex").addClass("d-none"),$("h6","#price-package").html("Package: Registration Only"),i();break;case"race_pack":$("select","#tshirt").prop("disabled",!1),$("input","#donate_field").prop("disabled",!0),$("#shipping-details").removeClass("d-none").prop("disabled",!1),$("#price-shipping").addClass("d-flex").removeClass("d-none"),$("h6","#price-package").html("Package: Race Pack"),i();break;case"donation":$("select","#tshirt").prop("disabled",!0),$("input","#donate_field").prop("disabled",!1),$("#shipping-details").addClass("d-none").prop("disabled",!0),$("#price-shipping").removeClass("d-flex").addClass("d-none"),$("h6","#price-package").html("Package: Donation"),i()}}),$("input[type=radio][name=shipping_method]").change(function(){switch($(this).val().toLowerCase()){case"delivery":$("#shipping-address").prop("disabled",!1),$("#pickup_location").prop("disabled",!0),$("h6","#price-shipping").html("Shipping: Delivery"),i();break;case"pickup":$("#shipping-address").prop("disabled",!0),$("#pickup_location").prop("disabled",!1),$("h6","#price-shipping").html("Shipping: Pickup"),i()}}),$("#waiver").keyup(function(){""==$(this).val()?$("#waiver-holder").addClass("waiver").removeClass("waiver-ok"):$("#waiver-holder").addClass("waiver-ok").removeClass("waiver")}),$("#donation_amount").change(function(){i()}),$("#donation_amount").keyup(function(){i()}),$(".coupon").on("click",function(e){o($(this).text()),$("#copied_"+$(this).data("discount")).text("Copied to clipboard").show().css("display","inline").fadeOut(2e3)}),$("#coupon").bind("keyup input",function(){a&&clearTimeout(a),a=setTimeout(t,300)}),$("#confirm_update")&&($("input[name=race_package]:checked").trigger("change"),$("input[name=shipping_method]:checked").trigger("change")),1==$(".overlay").data("ws")&&((e=new autobahn.Connection({url:"wss://"+location.host+"/payment",realm:"payment_checker",skipSubprotocolCheck:!0})).onopen=function(a,i){a.subscribe(hash,function(a){var i=a[a.length-1];"success"==i.status&&($("#ref").html(i.ticket),$(".overlay").removeClass("d-none"),e.close())}),a.register("ping",function(e){}),function e(a){a.call("ping",[]).then(function(i){setTimeout(function(){e(a)},5e3)})}(a)},e.onclose=function(e,a){},e.open())}();var a=0;function i(){var e=0,i=0,t=0,n=e+i-t,o=!1,r=!0;switch($("input[name=race_package]:checked").val()){case"only_registration":n=(e=2e5)+(i=0),$("span","#price-package").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(e)+"&#8365;"),$("strong","#price-total").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(n)+"&#8365;");break;case"race_pack":n=(e=3e5)+i,o=!0,$("span","#price-package").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(e)+"&#8365;"),$("strong","#price-total").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(n)+"&#8365;");break;case"donation":n=(e=parseInt($("#donation_amount").val()||"0"))+(i=0),r=!1,$("#price-discount").removeClass("d-flex").addClass("d-none"),$("span","#price-package").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(e)+"&#8365;"),$("strong","#price-total").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(n)+"&#8365;")}if(i=0,1==o)switch($("input[name=shipping_method]:checked").val()){case"delivery":n=e+(i=15e3),$("span","#price-shipping").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(i)+"&#8365;"),$("strong","#price-total").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(n)+"&#8365;");break;case"pickup":n=e+(i=0),$("span","#price-shipping").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(i)+"&#8365;"),$("strong","#price-total").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(n)+"&#8365;")}if(1==r&&a>0){n=e+i-(t=e*(a/100));var s=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t);$("#price-discount").removeClass("d-none").addClass("d-flex"),$("span","#price-discount").html("-"+s+"&#8365;"),$("strong","#price-total").html(new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(n)+"&#8365;"),$("#received_amount").val(n),$("#received_discount").html("("+a+"% discount)")}}function t(){$.ajax("/register/coupon.php?c="+$("#coupon").val()).done(function(e){e.error?(a=0,$("#coupon").addClass("is-invalid").removeClass("is-valid"),$("#coupon").parent().find("div").html(e.error),$("#price-discount").removeClass("d-flex").addClass("d-none"),i()):e.discount_amount&&(a=e.discount_amount,$("#coupon").addClass("is-valid").removeClass("is-invalid"),$("h6","#price-discount").html("Discount ("+a+"%):"),i())})}function n(e){var a=$("<textarea>");$("body").append(a),a.val(e).select();try{document.execCommand("copy")}catch(e){}a.remove()}function o(e){navigator.clipboard?navigator.clipboard.writeText(e).then(function(){},function(e){}):n(e)}